<ion-content [fullscreen]="true">
  <div class="page-container">
    <!-- Encabezado Fijo -->
    <header class="page-header">
      <div class="header-content">
        <h1 class="page-title">Listas Semanales</h1>
        <p class="page-subtitle">Gestiona tus repertorios</p>
      </div>
      
      <div class="header-actions">
        <div class="search-wrapper">
          <ion-icon name="search-outline"></ion-icon>
          <input 
            type="text" 
            placeholder="Buscar lista..." 
            [(ngModel)]="searchTerm" 
            (input)="filterLists()"
          >
        </div>
        
        <button class="action-btn add-btn" (click)="openAddList()">
          <ion-icon name="add-outline"></ion-icon>
          <span>Nueva Lista</span>
        </button>
        
        <button class="action-btn delete-btn" (click)="confirmDelete()" *ngIf="!showCheckboxes && lists.length > 0">
          <ion-icon name="trash-outline"></ion-icon>
        </button>
      </div>
    </header>

    <!-- Banner de Selección de Canciones -->
    <div class="info-banner slide-in" *ngIf="selectedSongs.length > 0 && !showCheckboxes">
      <div class="banner-content">
        <div class="icon-wrapper">
          <ion-icon name="musical-notes"></ion-icon>
        </div>
        <div class="text-content">
          <h3>{{ selectedSongs.length }} canciones seleccionadas</h3>
          <p>Elige una lista para añadirlas</p>
        </div>
      </div>
    </div>

    <!-- Banner de Confirmación de Eliminación -->
    <div class="danger-banner slide-in" *ngIf="showCheckboxes">
      <div class="banner-content">
        <div class="icon-wrapper">
          <ion-icon name="warning"></ion-icon>
        </div>
        <div class="text-content">
          <h3>Modo Eliminación</h3>
          <p>Selecciona las listas que deseas borrar</p>
        </div>
      </div>
      <div class="banner-actions">
        <button class="cancel-btn" (click)="cancelSelectedLists()">Cancelar</button>
        <button class="confirm-btn" (click)="presentDeleteConfirm()">Eliminar</button>
      </div>
    </div>

    <!-- Grid de Listas -->
    <div class="lists-grid" *ngIf="filteredLists.length > 0; else emptyState">
      <div 
        class="list-card" 
        *ngFor="let list of filteredLists; trackBy: trackById"
        [class.selected-mode]="showCheckboxes"
        [class.active]="list.selected"
        (click)="showCheckboxes ? list.selected = !list.selected : openListPage(list.id)"
      >
        <div class="card-status-strip" [class.active]="list.status"></div>
        
        <div class="card-content">
          <div class="card-header">
            <div class="icon-box">
              <ion-icon name="list"></ion-icon>
            </div>
            <div class="status-toggle" (click)="$event.stopPropagation()" *ngIf="!showCheckboxes">
              <ion-toggle 
                [checked]="list.status" 
                (ionChange)="toggleStatus(list, $event)"
                mode="ios"
              ></ion-toggle>
            </div>
            <div class="checkbox-wrapper" *ngIf="showCheckboxes">
              <ion-checkbox 
                [(ngModel)]="list.selected" 
                (click)="$event.stopPropagation()"
              ></ion-checkbox>
            </div>
          </div>

          <div class="card-body">
            <div class="list-name-container" style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
              <h3 class="list-name" style="margin: 0;">{{ list.name }}</h3>
              
              <ion-button fill="clear" size="small" (click)="editList(list, $event)" *ngIf="!showCheckboxes" style="--padding-start: 4px; --padding-end: 4px; height: 24px;">
                <ion-icon name="create-outline" style="font-size: 1.2rem;"></ion-icon>
              </ion-button>
            </div>
            <p class="song-count">
              <ion-icon name="musical-note"></ion-icon>
              {{ list.songs.length || 0 }} canciones
            </p>
          </div>

          <div class="card-footer">
            <span class="date-badge">
              {{ list.createdAt | date:'dd MMM yyyy' }}
            </span>
            
            <button 
              class="add-songs-btn" 
              *ngIf="selectedSongs.length > 0 && !showCheckboxes"
              (click)="presentAddConfirm(list.id); $event.stopPropagation()"
            >
              <ion-icon name="add"></ion-icon>
              Añadir
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Estado Vacío -->
    <ng-template #emptyState>
      <div class="empty-state">
        <div class="empty-illustration">
          <ion-icon name="albums-outline"></ion-icon>
        </div>
        <h2>No hay listas creadas</h2>
        <p>Comienza creando tu primera lista de repertorio</p>
        <button class="create-first-btn" (click)="openAddList()">
          Crear Lista
        </button>
      </div>
    </ng-template>
  </div>
</ion-content>
